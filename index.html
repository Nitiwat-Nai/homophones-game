<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡πÄ‡∏Å‡∏°‡∏ù‡∏∂‡∏Å‡∏®‡∏±‡∏û‡∏ó‡πå Homophones (Level)</title>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        /* Mobile-First CSS with Vibrant Colors */
        :root {
            --color-primary: #FF7043; /* Bright Orange */
            --color-secondary: #42A5F5; /* Blue */
            --color-correct: #66BB6A; /* Green */
            --color-wrong: #EF5350; /* Red */
            --color-bg: #F4F7F9;
            --color-card: #FFFFFF;
            --color-text-dark: #263238;
            --color-text-light: #FFFFFF;
        }

        body {
            font-family: 'Sarabun', sans-serif;
            background-color: var(--color-bg);
            color: var(--color-text-dark);
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            text-align: center;
        }

        .container {
            width: 100%;
            max-width: 500px;
            box-sizing: border-box;
            background-color: var(--color-card);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
            padding: 0;
        }

        /* Header */
        header {
            background-color: var(--color-primary);
            color: var(--color-text-light);
            padding: 1.5rem 1rem;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.15);
            margin-bottom: 1rem;
        }
        header h1 {
            font-size: 1.8rem;
            margin: 0;
        }

        /* Screen Management */
        .screen {
            padding: 1rem;
            display: none; /* Hidden by default */
            flex-grow: 1;
            flex-direction: column;
            justify-content: space-between;
        }
        .screen.active {
            display: flex;
        }

        /* --- Level Selection Screen --- */
        #level-select-screen .level-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            padding: 1rem 0;
        }
        .level-btn {
            background-color: var(--color-secondary);
            color: var(--color-text-light);
            border: none;
            padding: 1.5rem 0.5rem;
            border-radius: 12px;
            font-size: 1.4rem;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 4px 0 #3188d6;
            transition: transform 0.1s, box-shadow 0.1s;
        }
        .level-btn:active {
            transform: translateY(2px);
            box-shadow: 0 2px 0 #3188d6;
        }
        .level-btn-title {
            font-size: 0.8rem;
            font-weight: 400;
            display: block;
            margin-top: 5px;
        }
        
        /* --- Game Screen --- */
        #game-screen .status-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.5rem 0;
            font-weight: bold;
            margin-bottom: 1.5rem;
        }

        /* Prompt Area (Thai Word) */
        #prompt-area {
            background-color: var(--color-bg);
            border: 3px solid var(--color-primary);
            border-radius: 20px;
            padding: 2rem 1rem;
            min-height: 100px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            margin-bottom: 1.5rem;
        }
        #thai-prompt {
            font-size: 2rem;
            font-weight: 900;
            color: var(--color-primary);
            line-height: 1.3;
        }

        /* Timer Bar */
        #timer-bar-container {
            width: 100%;
            height: 10px;
            background-color: #ECEFF1;
            border-radius: 5px;
            margin-bottom: 1rem;
            overflow: hidden;
        }
        #timer-bar {
            width: 100%;
            height: 100%;
            background-color: var(--color-secondary);
            transition: width 5s linear;
        }

        /* Choice Buttons */
        #choices {
            display: flex;
            flex-direction: column;
            gap: 12px;
            flex-grow: 1; /* Allow buttons to push down footer */
            justify-content: center; /* Center buttons vertically */
        }
        .choice-button {
            background-color: #3498DB;
            color: var(--color-text-light);
            border: none;
            padding: 1.5rem;
            border-radius: 15px; 
            font-size: 1.6rem;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 5px 0 #2980B9;
            transition: all 0.2s ease-in-out;
        }
        .choice-button:not([disabled]):active { 
            transform: translateY(3px); 
            box-shadow: 0 2px 0 #2980B9; 
        }
        .choice-button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            pointer-events: none;
        }

        /* Feedback Colors & Reveal */
        .choice-button.correct {
            background-color: var(--color-correct);
            box-shadow: 0 5px 0 #388E3C;
            font-size: 2.5rem; /* Large text on correct reveal */
            transition: font-size 0.5s;
        }
        .choice-button.wrong {
            background-color: var(--color-wrong);
            box-shadow: 0 5px 0 #C62828;
        }
        .choice-button.hidden-on-reveal {
            opacity: 0;
            height: 0;
            padding: 0;
            margin: 0;
            transition: opacity 0.3s, height 0.3s, padding 0.3s, margin 0.3s;
        }

        /* Footer/Control */
        #game-footer {
            margin-top: 2rem;
            padding-top: 1rem;
            border-top: 1px solid #ECEFF1;
        }
        #next-btn {
            background-color: var(--color-primary);
            color: var(--color-text-light);
            border: none;
            width: 100%;
            padding: 1rem;
            border-radius: 50px;
            font-size: 1.2rem;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 4px 0 #E64A19;
            transition: all 0.1s;
        }
        #next-btn:active {
            transform: translateY(2px);
            box-shadow: 0 2px 0 #E64A19;
        }
    </style>
</head>
<body>

    <div class="container">
        <header>
            <h1>Homophone Quiz Challenge</h1>
        </header>

        <div id="level-select-screen" class="screen active">
            <h2>üèÜ ‡πÄ‡∏•‡πÄ‡∏ß‡∏•‡∏ó‡∏µ‡πà 1 - 10</h2>
            <p>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏•‡πÄ‡∏ß‡∏•‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏ù‡∏∂‡∏Å‡∏ù‡∏ô:</p>
            <div class="level-grid" id="level-grid">
                </div>
            <p style="padding-top: 2rem; color:#9E9E9E;">‡∏°‡∏µ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î 100 ‡∏Ñ‡∏≥‡∏®‡∏±‡∏û‡∏ó‡πå</p>
        </div>

        <div id="game-screen" class="screen">
            <div class="top-content">
                <div class="status-bar">
                    <span id="level-title">Level: </span>
                    <span id="q-count">‡∏Ç‡πâ‡∏≠: 0/10</span>
                    <span id="score">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô: 0</span>
                </div>

                <div id="timer-bar-container">
                    <div id="timer-bar"></div>
                </div>

                <div id="prompt-area">
                    <span id="thai-prompt">‡πÇ‡∏à‡∏ó‡∏¢‡πå‡∏Ñ‡∏≥‡πÅ‡∏õ‡∏•‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢</span>
                </div>

                <div id="choices">
                    <button id="choice-A" class="choice-button" disabled></button>
                    <button id="choice-B" class="choice-button" disabled></button>
                </div>
            </div>

            <div id="game-footer">
                <button id="next-btn" disabled>‡∏Ç‡πâ‡∏≠‡∏ñ‡∏±‡∏î‡πÑ‡∏õ/‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</button>
            </div>
        </div>
    </div>

    <script>
        // --- DATA (10 Levels x 10 Questions) ---
        const allQuizData = [
            { level: 1, title: "‡∏Ñ‡∏≥‡∏û‡πâ‡∏≠‡∏á‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô 1", questions: [
                { thai: "‡∏ñ‡∏∂‡∏á, ‡∏™‡∏π‡πà (‡∏Ñ‡∏≥‡∏ö‡∏∏‡∏û‡∏ö‡∏ó)", correct: "to", decoy: "too" },
                { thai: "‡∏Ç‡∏≠‡∏á‡∏û‡∏ß‡∏Å‡πÄ‡∏Ç‡∏≤", correct: "their", decoy: "there" },
                { thai: "‡πÑ‡∏î‡πâ‡∏¢‡∏¥‡∏ô", correct: "hear", decoy: "here" },
                { thai: "‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô", correct: "write", decoy: "right" },
                { thai: "‡πÉ‡∏´‡∏°‡πà", correct: "new", decoy: "knew" },
                { thai: "‡∏û‡∏£‡∏∞‡∏≠‡∏≤‡∏ó‡∏¥‡∏ï‡∏¢‡πå", correct: "sun", decoy: "son" },
                { thai: "‡∏ã‡∏∑‡πâ‡∏≠", correct: "buy", decoy: "by" },
                { thai: "‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ö‡∏¥‡∏ô", correct: "plane", decoy: "plain" },
                { thai: "‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå", correct: "week", decoy: "weak" },
                { thai: "‡∏´‡∏ô‡∏∂‡πà‡∏á (1)", correct: "one", decoy: "won" },
            ]},
            { level: 2, title: "‡∏Ñ‡∏≥‡∏û‡πâ‡∏≠‡∏á‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô 2", questions: [
                { thai: "‡∏£‡∏π‡πâ‡∏à‡∏±‡∏Å", correct: "knew", decoy: "new" },
                { thai: "‡∏•‡∏π‡∏Å‡∏ä‡∏≤‡∏¢", correct: "son", decoy: "sun" },
                { thai: "‡πÇ‡∏î‡∏¢", correct: "by", decoy: "buy" },
                { thai: "‡∏ò‡∏£‡∏£‡∏°‡∏î‡∏≤, ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏á‡πà‡∏≤‡∏¢", correct: "plain", decoy: "plane" },
                { thai: "‡∏≠‡πà‡∏≠‡∏ô‡πÅ‡∏≠", correct: "weak", decoy: "week" },
                { thai: "‡∏ä‡∏ô‡∏∞", correct: "won", decoy: "one" },
                { thai: "‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î", correct: "all", decoy: "awl" },
                { thai: "‡∏ó‡∏∞‡πÄ‡∏•", correct: "sea", decoy: "see" },
                { thai: "‡πÄ‡∏ö‡∏∑‡πà‡∏≠", correct: "bored", decoy: "board" },
                { thai: "‡∏°‡∏µ (‡∏Å‡∏£‡∏¥‡∏¢‡∏≤)", correct: "have", decoy: "half" },
            ]},
            { level: 3, title: "‡∏Ñ‡∏π‡πà‡∏ó‡∏µ‡πà‡∏û‡∏ö‡∏ö‡πà‡∏≠‡∏¢", questions: [
                { thai: "‡∏ä‡∏¥‡πâ‡∏ô, ‡∏™‡πà‡∏ß‡∏ô", correct: "piece", decoy: "peace" },
                { thai: "‡∏î‡∏π", correct: "see", decoy: "sea" },
                { thai: "‡∏£‡∏π", correct: "hole", decoy: "whole" },
                { thai: "‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î", correct: "whole", decoy: "hole" },
                { thai: "‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö", correct: "for", decoy: "four" },
                { thai: "‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç 4", correct: "four", decoy: "for" },
                { thai: "‡πÅ‡∏õ‡∏î", correct: "eight", decoy: "ate" },
                { thai: "‡∏Å‡∏¥‡∏ô (‡∏≠‡∏î‡∏µ‡∏ï)", correct: "ate", decoy: "eight" },
                { thai: "‡∏î‡∏≠‡∏Å‡πÑ‡∏°‡πâ", correct: "flower", decoy: "flour" },
                { thai: "‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á", correct: "hour", decoy: "our" },
            ]},
            { level: 4, title: "‡∏Ñ‡∏≥‡∏Å‡∏£‡∏¥‡∏¢‡∏≤", questions: [
                { thai: "‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï", correct: "allow", decoy: "aloud" },
                { thai: "‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏î‡∏±‡∏á", correct: "aloud", decoy: "allow" },
                { thai: "‡∏ó‡∏≥‡∏•‡∏≤‡∏¢", correct: "break", decoy: "brake" },
                { thai: "‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡∏Å‡∏≤‡∏£‡∏´‡∏¢‡∏∏‡∏î", correct: "brake", decoy: "break" },
                { thai: "‡∏û‡∏ö", correct: "meet", decoy: "meat" },
                { thai: "‡πÄ‡∏ô‡∏∑‡πâ‡∏≠", correct: "meat", decoy: "meet" },
                { thai: "‡∏£‡∏≠", correct: "wait", decoy: "weight" },
                { thai: "‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å", correct: "weight", decoy: "wait" },
                { thai: "‡∏£‡∏π‡πâ", correct: "know", decoy: "no" },
                { thai: "‡πÑ‡∏°‡πà", correct: "no", decoy: "know" },
            ]},
            { level: 5, title: "‡∏Ñ‡∏≥‡∏ô‡∏≤‡∏°", questions: [
                { thai: "‡∏´‡∏≤‡∏á", correct: "tail", decoy: "tale" },
                { thai: "‡∏ô‡∏¥‡∏ó‡∏≤‡∏ô", correct: "tale", decoy: "tail" },
                { thai: "‡∏ó‡∏≤‡∏á, ‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á", correct: "road", decoy: "rode" },
                { thai: "‡∏Ç‡∏µ‡πà (‡∏≠‡∏î‡∏µ‡∏ï)", correct: "rode", decoy: "road" },
                { thai: "‡∏Ç‡∏ô‡∏™‡∏±‡∏ï‡∏ß‡πå", correct: "fur", decoy: "fir" },
                { thai: "‡∏ï‡πâ‡∏ô‡∏™‡∏ô", correct: "fir", decoy: "fur" },
                { thai: "‡∏Ñ‡∏π‡πà, ‡∏™‡∏≠‡∏á", correct: "pair", decoy: "pear" },
                { thai: "‡∏•‡∏π‡∏Å‡πÅ‡∏û‡∏£‡πå", correct: "pear", decoy: "pair" },
                { thai: "‡∏à‡∏î‡∏´‡∏°‡∏≤‡∏¢", correct: "mail", decoy: "male" },
                { thai: "‡πÄ‡∏û‡∏®‡∏ä‡∏≤‡∏¢", correct: "male", decoy: "mail" },
            ]},
            { level: 6, title: "‡∏Ç‡∏±‡πâ‡∏ô‡∏™‡∏π‡∏á 1", questions: [
                { thai: "‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏á‡∏ö‡∏™‡∏∏‡∏Ç", correct: "peace", decoy: "piece" },
                { thai: "‡∏¢‡∏≠‡∏°‡∏£‡∏±‡∏ö", correct: "accept", decoy: "except" },
                { thai: "‡∏¢‡∏Å‡πÄ‡∏ß‡πâ‡∏ô", correct: "except", decoy: "accept" },
                { thai: "‡∏´‡∏•‡∏±‡∏Å‡∏Å‡∏≤‡∏£, ‡∏´‡∏±‡∏ß‡∏´‡∏ô‡πâ‡∏≤", correct: "principal", decoy: "principle" },
                { thai: "‡∏Å‡∏é, ‡∏ó‡∏§‡∏©‡∏é‡∏µ", correct: "principle", decoy: "principal" },
                { thai: "‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏ï‡∏Å‡∏ï‡πà‡∏≤‡∏á", correct: "affect", decoy: "effect" },
                { thai: "‡∏ú‡∏•‡∏Å‡∏£‡∏∞‡∏ó‡∏ö", correct: "effect", decoy: "affect" },
                { thai: "‡∏Å‡∏≤‡∏£‡∏Ç‡∏ô‡∏™‡πà‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤", correct: "haul", decoy: "hall" },
                { thai: "‡∏´‡πâ‡∏≠‡∏á‡πÇ‡∏ñ‡∏á", correct: "hall", decoy: "haul" },
                { thai: "‡∏ñ‡∏π‡∏Å‡∏ú‡∏π‡∏Å‡πÑ‡∏ß‡πâ (‡πÇ‡∏î‡∏¢‡∏Å‡∏é)", correct: "bound", decoy: "bounces" },
            ]},
            { level: 7, title: "‡∏Ç‡∏±‡πâ‡∏ô‡∏™‡∏π‡∏á 2", questions: [
                { thai: "‡∏ù‡∏ô", correct: "rain", decoy: "reign" },
                { thai: "‡∏Ñ‡∏£‡∏≠‡∏á‡∏£‡∏≤‡∏ä‡∏¢‡πå", correct: "reign", decoy: "rain" },
                { thai: "‡∏ö‡∏ó", correct: "role", decoy: "roll" },
                { thai: "‡∏°‡πâ‡∏ß‡∏ô", correct: "roll", decoy: "role" },
                { thai: "‡πÄ‡∏ã‡∏•‡∏•‡πå", correct: "cell", decoy: "sell" },
                { thai: "‡∏Ç‡∏≤‡∏¢", correct: "sell", decoy: "cell" },
                { thai: "‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà", correct: "site", decoy: "sight" },
                { thai: "‡∏™‡∏≤‡∏¢‡∏ï‡∏≤", correct: "sight", decoy: "site" },
                { thai: "‡∏™‡πà‡∏≠‡∏á‡πÅ‡∏™‡∏á", correct: "shine", decoy: "sheen" },
                { thai: "‡πÇ‡∏î‡∏¢‡∏£‡∏≠‡∏ö", correct: "around", decoy: "round" },
            ]},
            { level: 8, title: "‡∏Ñ‡∏≥‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏ß‡∏•‡∏µ", questions: [
                { thai: "‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡∏®‡∏π‡∏ô‡∏¢‡πå", correct: "zero", decoy: "hero" },
                { thai: "‡πÄ‡∏£‡∏∑‡∏≠", correct: "ship", decoy: "sheep" },
                { thai: "‡πÅ‡∏Å‡∏∞", correct: "sheep", decoy: "ship" },
                { thai: "‡πÉ‡∏ö‡πÑ‡∏°‡πâ", correct: "leaf", decoy: "live" },
                { thai: "‡πÄ‡∏™‡∏∑‡πâ‡∏≠‡∏ú‡πâ‡∏≤", correct: "clothes", decoy: "cloths" },
                { thai: "‡∏õ‡∏¥‡∏î", correct: "close", decoy: "cloze" },
                { thai: "‡πÉ‡∏Å‡∏•‡πâ", correct: "close", decoy: "cloze" },
                { thai: "‡∏Å‡∏≤‡∏£‡∏™‡∏π‡∏ç‡πÄ‡∏™‡∏µ‡∏¢", correct: "lose", decoy: "loose" },
                { thai: "‡∏´‡∏•‡∏ß‡∏°", correct: "loose", decoy: "lose" },
                { thai: "‡∏´‡∏≤‡∏¢‡πÉ‡∏à", correct: "breathe", decoy: "breath" },
            ]},
            { level: 9, title: "‡∏Ñ‡∏≥‡πÉ‡∏Å‡∏•‡πâ‡πÄ‡∏Ñ‡∏µ‡∏¢‡∏á", questions: [
                { thai: "‡∏•‡∏°‡∏´‡∏≤‡∏¢‡πÉ‡∏à", correct: "breath", decoy: "breathe" },
                { thai: "‡∏°‡∏≤‡∏£‡∏¢‡∏≤‡∏ó", correct: "manner", decoy: "manor" },
                { thai: "‡∏Ñ‡∏§‡∏´‡∏≤‡∏™‡∏ô‡πå", correct: "manor", decoy: "manner" },
                { thai: "‡πÄ‡∏õ‡πá‡∏ô‡∏Å‡∏•‡∏≤‡∏á", correct: "neutral", decoy: "nurture" },
                { thai: "‡∏Ñ‡∏∏‡∏ì‡∏ò‡∏£‡∏£‡∏°", correct: "virtue", decoy: "virtuous" },
                { thai: "‡∏Ç‡∏ô‡∏°‡∏´‡∏ß‡∏≤‡∏ô", correct: "dessert", decoy: "desert" },
                { thai: "‡∏ó‡∏∞‡πÄ‡∏•‡∏ó‡∏£‡∏≤‡∏¢", correct: "desert", decoy: "dessert" },
                { thai: "‡πÄ‡∏®‡∏£‡∏©‡∏ê‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå", correct: "economic", decoy: "economical" },
                { thai: "‡∏°‡∏µ‡∏Ñ‡∏∏‡∏ì‡∏ò‡∏£‡∏£‡∏°", correct: "moral", decoy: "morale" },
                { thai: "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÉ‡∏à", correct: "morale", decoy: "moral" },
            ]},
            { level: 10, title: "‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡πâ‡∏≤‡∏ó‡∏≤‡∏¢‡∏£‡∏ß‡∏°", questions: [
                { thai: "‡∏û‡∏≤‡∏¢‡∏∏‡∏´‡∏¥‡∏°‡∏∞", correct: "blizzard", decoy: "billiard" },
                { thai: "‡πÇ‡∏ï‡πä‡∏∞‡∏™‡∏ô‡∏∏‡πä‡∏Å", correct: "billiard", decoy: "blizzard" },
                { thai: "‡∏Ñ‡∏ô‡πÅ‡∏õ‡∏•‡∏Å‡∏´‡∏ô‡πâ‡∏≤", correct: "stranger", decoy: "stronger" },
                { thai: "‡πÅ‡∏Ç‡πá‡∏á‡πÅ‡∏£‡∏á‡∏Å‡∏ß‡πà‡∏≤", correct: "stronger", decoy: "stranger" },
                { thai: "‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠", correct: "tool", decoy: "tulle" },
                { thai: "‡∏ï‡∏≤‡∏Ç‡πà‡∏≤‡∏¢‡∏ö‡∏≤‡∏á", correct: "tulle", decoy: "tool" },
                { thai: "‡∏Ç‡∏ô‡∏°‡∏õ‡∏±‡∏á‡∏≠‡∏ö", correct: "dough", decoy: "doe" },
                { thai: "‡∏Å‡∏ß‡∏≤‡∏á‡∏ï‡∏±‡∏ß‡πÄ‡∏°‡∏µ‡∏¢", correct: "doe", decoy: "dough" },
                { thai: "‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏î‡∏±‡∏á‡∏Å‡πâ‡∏≠‡∏á", correct: "boom", decoy: "bomb" },
                { thai: "‡∏£‡∏∞‡πÄ‡∏ö‡∏¥‡∏î", correct: "bomb", decoy: "boom" },
            ]},
        ];

        // --- ELEMENTS ---
        const levelSelectScreen = document.getElementById('level-select-screen');
        const gameScreen = document.getElementById('game-screen');
        const levelGridEl = document.getElementById('level-grid');

        const levelTitleEl = document.getElementById('level-title');
        const qCountEl = document.getElementById('q-count');
        const scoreEl = document.getElementById('score');
        const thaiPromptEl = document.getElementById('thai-prompt');
        const timerBarEl = document.getElementById('timer-bar');
        const choiceA = document.getElementById('choice-A');
        const choiceB = document.getElementById('choice-B');
        const nextBtn = document.getElementById('next-btn');
        const choiceButtons = [choiceA, choiceB];

        // --- GAME STATE ---
        let currentLevelData = null;
        let currentQuizIndex = 0;
        let score = 0;
        let timerTimeout = null;
        let isAnswered = false;
        let isSpeaking = false;
        let voices = [];
        let audioContext;

        // --- CORE FUNCTIONS (AUDIO) ---

        function initAudioContext() {
             // Initialize AudioContext lazily on user interaction
            if (!audioContext) {
                // To avoid "The AudioContext was not allowed to start" error, initialize on a user-driven event (like the first button click).
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
            }
        }
        
        // Function to create and play a simple tone (Ping/Fail)
        function createTone(frequency, duration, type, volume = 0.5, startFreq = null) {
            initAudioContext();
            if (!audioContext) return;
            
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();

            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);

            if (startFreq) {
                // For a slight pitch bend effect on correct
                oscillator.frequency.setValueAtTime(startFreq, audioContext.currentTime);
                oscillator.frequency.linearRampToValueAtTime(frequency, audioContext.currentTime + duration * 0.5);
            } else {
                 oscillator.frequency.setValueAtTime(frequency, audioContext.currentTime);
            }
            
            oscillator.type = type; 

            gainNode.gain.setValueAtTime(volume, audioContext.currentTime);
            // Fade out the sound (A sharp decay)
            gainNode.gain.exponentialRampToValueAtTime(0.00001, audioContext.currentTime + duration);

            oscillator.start();
            oscillator.stop(audioContext.currentTime + duration);
        }

        function playPing() {
            // A quick, rising tone
            createTone(880, 0.15, 'sine', 0.8, 660); 
        }

        function playFailTone() {
            // A low, dropping tone
            createTone(150, 0.4, 'triangle', 0.7, 200); 
        }

        // --- CORE FUNCTIONS (SPEECH) ---

        function setupSpeech() {
            if ('speechSynthesis' in window) {
                window.speechSynthesis.onvoiceschanged = () => {
                    voices = window.speechSynthesis.getVoices();
                };
            }
        }
        
        function getVoice(lang) {
            if (lang === 'en-US') {
                return voices.find(v => v.lang.startsWith('en-US') && (v.name.includes('Samantha') || v.name.includes('Google US English'))) || voices.find(v => v.lang.startsWith('en-US'));
            }
            return null;
        }

        function speakText(text, lang, onEndCallback = null) {
            if (!'speechSynthesis' in window) {
                if(onEndCallback) onEndCallback();
                return;
            }
            window.speechSynthesis.cancel();
            isSpeaking = true;
            const utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = lang;
            utterance.rate = 0.8;
            utterance.volume = 1;

            const targetVoice = getVoice(lang);
            if (targetVoice) {
                utterance.voice = targetVoice;
            }

            utterance.onend = () => {
                isSpeaking = false;
                if (onEndCallback) onEndCallback();
            };
            utterance.onerror = () => {
                isSpeaking = false;
                if (onEndCallback) onEndCallback();
            };
            window.speechSynthesis.speak(utterance);
        }

        // --- UI & SCREEN MANAGEMENT ---

        function showScreen(id) {
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.remove('active');
            });
            document.getElementById(id).classList.add('active');
        }

        function createLevelButtons() {
            levelGridEl.innerHTML = '';
            allQuizData.forEach(data => {
                const btn = document.createElement('button');
                btn.className = 'level-btn';
                btn.textContent = `Level ${data.level}`;
                
                const titleSpan = document.createElement('span');
                titleSpan.className = 'level-btn-title';
                titleSpan.textContent = data.title;
                
                btn.appendChild(titleSpan);
                btn.setAttribute('data-level', data.level);
                // Call initAudioContext on first interaction
                btn.addEventListener('click', () => {
                    initAudioContext(); 
                    startLevel(data.level);
                });
                levelGridEl.appendChild(btn);
            });
        }

        function updateStatusBar() {
            levelTitleEl.textContent = `${currentLevelData.title} (Level ${currentLevelData.level})`;
            qCountEl.textContent = `‡∏Ç‡πâ‡∏≠: ${currentQuizIndex}/${currentLevelData.questions.length}`;
            scoreEl.textContent = `‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô: ${score}`;
        }

        // --- GAME LOGIC ---

        function startLevel(levelId) {
            currentLevelData = allQuizData.find(data => data.level === levelId);
            currentQuizIndex = 0;
            score = 0;
            showScreen('game-screen');
            nextQuestion();
        }

        function nextQuestion() {
            clearTimeout(timerTimeout);
            window.speechSynthesis.cancel();
            
            if (currentQuizIndex >= currentLevelData.questions.length) {
                endGame();
                return;
            }
            
            isAnswered = false;
            nextBtn.textContent = '‡∏Ç‡πâ‡∏≠‡∏ñ‡∏±‡∏î‡πÑ‡∏õ';
            nextBtn.disabled = true;

            // Reset UI
            thaiPromptEl.style.fontSize = '2rem';
            thaiPromptEl.style.color = 'var(--color-primary)';
            choiceButtons.forEach(btn => {
                btn.className = 'choice-button';
                btn.disabled = false;
            });
            
            updateStatusBar();
            setupQuestion(currentLevelData.questions[currentQuizIndex]);
        }

        function setupQuestion(q) {
            // Setup Prompt
            thaiPromptEl.textContent = q.thai;

            // Setup Choices (Randomize position)
            const choices = [q.correct, q.decoy];
            choices.sort(() => 0.5 - Math.random());

            choiceA.textContent = choices[0];
            choiceA.setAttribute('data-correct', choices[0] === q.correct);
            choiceB.textContent = choices[1];
            choiceB.setAttribute('data-correct', choices[1] === q.correct);

            // Start Timer
            startTimer();
        }

        function startTimer() {
            // Reset timer bar CSS transition
            timerBarEl.style.transition = 'none';
            timerBarEl.style.width = '100%';
            
            // Force browser to reset (needed for re-transition)
            void timerBarEl.offsetWidth; 

            // Start countdown
            setTimeout(() => {
                timerBarEl.style.transition = 'width 5s linear';
                timerBarEl.style.width = '0%';
            }, 50);

            timerTimeout = setTimeout(() => {
                if (!isAnswered) {
                    checkAnswer(null); // Timeout
                }
            }, 5000);
        }

        function checkAnswer(selectedBtn) {
            if (isAnswered) return;
            isAnswered = true;
            clearTimeout(timerTimeout);
            
            // Stop timer bar animation immediately
            timerBarEl.style.transition = 'none';
            timerBarEl.style.width = '0%'; 

            const currentQ = currentLevelData.questions[currentQuizIndex];
            const correctWord = currentQ.correct;
            const isCorrect = selectedBtn && selectedBtn.getAttribute('data-correct') === 'true';

            // 1. Determine Feedback (Play Sound)
            if (isCorrect) {
                playPing();
                score++;
                thaiPromptEl.textContent = '‚úÖ ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á!';
            } else {
                playFailTone();
                thaiPromptEl.textContent = selectedBtn ? '‚ùå ‡∏ú‡∏¥‡∏î!' : '‡∏´‡∏°‡∏î‡πÄ‡∏ß‡∏•‡∏≤!';
            }
            
            // 2. Disable all choices
            choiceButtons.forEach(btn => btn.disabled = true);
            
            // 3. Reveal and animate
            revealAnswer(correctWord, selectedBtn);
            
            // 4. Set Next Button action
            nextBtn.disabled = false;
        }

        function revealAnswer(correctWord, selectedBtn) {
            // Read the correct word
            speakText(correctWord, 'en-US');
            
            // Animate choices
            choiceButtons.forEach(btn => {
                btn.classList.remove('wrong', 'correct');
                
                if (btn.textContent === correctWord) {
                    // Correct button
                    btn.classList.add('correct');
                } else {
                    // Wrong/Decoy buttons (and the incorrect choice)
                    btn.classList.add('hidden-on-reveal');
                }
            });
            
            // If it was a timeout or wrong answer, update prompt to show "Correct Word:"
            if (!selectedBtn || selectedBtn.getAttribute('data-correct') === 'false') {
                 thaiPromptEl.textContent = (thaiPromptEl.textContent.includes('‡∏´‡∏°‡∏î‡πÄ‡∏ß‡∏•‡∏≤') ? '‡∏´‡∏°‡∏î‡πÄ‡∏ß‡∏•‡∏≤: ' : '‚ùå ‡∏ú‡∏¥‡∏î: ') + currentLevelData.questions[currentQuizIndex].thai;
            }

            updateStatusBar();
        }


        function endGame() {
            levelTitleEl.textContent = `‡∏à‡∏ö Level ${currentLevelData.level}!`;
            qCountEl.textContent = '';
            
            thaiPromptEl.textContent = `‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏≥‡πÑ‡∏î‡πâ ${score}/${currentLevelData.questions.length} ‡∏Ç‡πâ‡∏≠`;
            thaiPromptEl.style.fontSize = '2.5rem';
            thaiPromptEl.style.color = score >= 8 ? 'var(--color-correct)' : 'var(--color-wrong)';

            choiceButtons.forEach(btn => btn.style.display = 'none');
            
            nextBtn.textContent = '‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å (Level Selection)';
            nextBtn.disabled = false;
        }

        // --- EVENT LISTENERS ---
        function handleChoiceClick(e) {
            // Ensure AudioContext is running
            initAudioContext();
            
            if (!isAnswered) {
                checkAnswer(e.target);
            }
        }

        choiceA.addEventListener('click', handleChoiceClick);
        choiceB.addEventListener('click', handleChoiceClick);

        nextBtn.addEventListener('click', () => {
            if (currentQuizIndex >= currentLevelData.questions.length) {
                // Back to Level Selection
                choiceButtons.forEach(btn => btn.style.display = 'block');
                showScreen('level-select-screen');
            } else {
                // Next Question
                currentQuizIndex++;
                nextQuestion();
            }
        });


        // --- INITIAL SETUP ---
        document.addEventListener('DOMContentLoaded', () => {
            setupSpeech();
            createLevelButtons();
            showScreen('level-select-screen');
        });
    </script>
</body>
</html>
